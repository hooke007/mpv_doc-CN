STATS
=====

这个内置脚本显示当前播放文件的信息和统计数据。如果mpv在编译时支持Lua，它就会默认启用。它可以通过 ``--load-stats-overlay=no`` 选项完全关闭。

Usage
-----

下面的键绑定默认是激活的，除非有其他东西已经绑定到它们：

====   ==============================================
i      在一个固定的时间内显示统计信息
I      切换统计信息（在再次切换之前显示）
====   ==============================================

当统计资料在屏幕上可见时，以下的键绑定是激活的，不管现有的绑定是什么。它们允许你在 *页面* 的统计资料之间切换：

====   ==================
1      显示通常的统计信息
2      显示帧计时（可滚动）
3      输入缓存统计
4      活跃的键绑定(可滚动)
0      内部的东西 (可滚动)
====   ==================

在支持滚动的页面上，这些键的绑定也是有效的：

====   ==================
UP     滚动一行
DOWN   滚动一行
====   ==================

Font
~~~~

为了获得最佳的视觉体验，建议使用支持多种字重和单行数字的字体。默认情况下，使用开源字体 `Source Sans Pro <https://github.com/adobe-fonts/source-sans-pro>`_ 。

Configuration
-------------

这个脚本可以通过放置在mpv用户目录下的配置文件 ``script-opts/stats.conf`` 和 ``--script-opts`` 命令行选项来定制。配置语法在 `ON SCREEN CONTROLLER`_ 中描述。

Configurable Options
~~~~~~~~~~~~~~~~~~~~

``key_page_1``
    默认： 1
``key_page_2``
    默认： 2
``key_page_3``
    默认： 3
``key_page_4``
    默认： 4
``key_page_0``
    默认： 0

    在显示统计信息时进行页面切换的键绑定。

``key_scroll_up``
    默认： UP
``key_scroll_down``
    默认： DOWN
``scroll_lines``
    默认： 1

    滚动键的绑定和在支持它的页面上滚动的行数。

``duration``
    默认： 4

    统计数字显示的时间，以秒为单位（单发）。

``redraw_delay``
    默认： 1

    刷新显示的统计资料的时间，以秒为单位（切换）。

``persistent_overlay``
    默认： no

    当 `no` 时，其他打印文本到屏幕的脚本可以覆盖显示的统计信息。当 `yes` 时，显示的统计信息会在相应的时间内持续显示。当多个脚本决定同时打印文本时，这可能导致文本的重叠。

``plot_perfdata``
    默认： yes

    显示性能数据的图表（第2页）。

``plot_vsync_ratio``
    默认： yes
``plot_vsync_jitter``
    默认： yes

    显示vsync和jitter值的图表（第1页）。只有在切换的时候。

``flush_graph_data``
    默认： yes

    在切换时清除用于绘制图形的数据缓冲区。

``font``
    默认： Source Sans Pro

    字体名称。应支持尽可能多的字重以获得最佳的视觉体验。

``font_mono``
    默认： Source Sans Pro

    字体名称，用于需要单行字符来对齐文本的部分。目前，单行的数字已经足够。

``font_size``
    默认： 8

    用于渲染文本的字体大小。

``font_color``
    默认： FFFFFF

    字体颜色。

``border_size``
    默认： 0.8

    围绕字体绘制的边框的大小。

``border_color``
    默认： 262626

    绘制边框的颜色。

``alpha``
    默认： 11

    绘制文本的透明度。

``plot_bg_border_color``
    默认： 0000FF

    用于绘制图形的边框颜色。

``plot_bg_color``
    默认： 262626

    用于绘制图形的背景颜色。

``plot_color``
    默认： FFFFFF

    用于绘制图形的颜色。

注意：颜色以十六进制值给出，并使用ASS标签顺序。BBGGRR（蓝绿红）。

Different key bindings
~~~~~~~~~~~~~~~~~~~~~~

可以在 ``input.conf`` 中配置额外的键来显示统计信息::

    e script-binding stats/display-stats
    E script-binding stats/display-stats-toggle

并直接显示某个页面::

    i script-binding stats/display-page-1
    e script-binding stats/display-page-2

Active key bindings page
~~~~~~~~~~~~~~~~~~~~~~~~

列出活动键绑定和它们所绑定的命令，不包括统计脚本本身的交互键。参见 ``--input-test`` 以获得每个绑定的更详细的视图。

这些键是通过对命令字符串的简单分析而自动分组的，人们不应该期望文件级别的分组精度，然而，它仍然应该是相当有用的。

使用 ``--idle --script-opts=stats-bindlist=yes`` 会将列表打印到终端并立即退出。默认情况下，长行会被缩短到79个字符，并且终端转义序列被启用。通过将 ``yes`` 改为数字（至少40）可以设置不同的长度限制，通过在数值前添加 ``-`` 可以禁用转义序列，例如 ``...=-yes`` 或 ``...=-120`` 。

和 ``--input-test`` 一样，列表中包括来自 ``input.conf`` 和用户脚本的捆绑。使用 ``--no-config`` 只列出内置绑定。

Internal stuff page
~~~~~~~~~~~~~~~~~~~

本页显示的大多数条目都有相当模糊的含义。可能这些东西对你都没有用。不要试图使用它。忘记它的存在。

第一次选择这个将开始收集一些内部性能数据。这意味着在玩家运行的其余时间里，性能会比正常情况下略低（即使统计页面被关闭）。注意，统计页面本身会使用大量的CPU甚至GPU资源，可能会对性能产生严重影响。

显示的信息是在重绘延迟期间积累的（显示为 ``poll-time`` 字段）。

这为每个Lua脚本增加了条目。如果有太多的脚本在运行，列表中的部分内容会简单地超出屏幕，但可以滚动。

如果底层平台不支持pthread的每线程时间，显示的时间将是0或随机的（我怀疑在写这篇文章的时候，只有Linux通过pthread API提供了正确的每线程时间）。

大多数条目都是懒洋洋地添加的，而且只在数据收集期间添加，这就是为什么条目在一段时间后可能会随机出现的原因。这也是为什么自数据收集开始以来一直不活动的脚本的内存使用条目会丢失。

内存使用量是近似的，并不反映内部碎片。

JS脚本的内存报告默认是禁用的，因为在JS端收集数据有一定的开销。在启动mpv之前，可以通过导出环境变量 ``MPV_LEAK_REPORT=1`` 来启用它，这将增加JS的内存使用。

如果条目有 ``/time`` 和 ``/cpu`` 变体，前者给出真实时间（monotonic clock），而后者给出线程CPU时间（只有当相应的pthread API工作并被支持时）。
