# éŸ³è§†é¢‘æ»¤é•œ

_ver.20231101_

> **è¯¥ç³»åˆ—æ–‡æ¡£å·²ç»åœæ­¢æ›´æ–°** è¯¦è§ï¼š [ä¸­æ­¢ç»´æŠ¤éå®˜æ–¹ç³»åˆ—æ–‡æ¡£](https://github.com/hooke007/mpv_PlayKit/issues/573)

## åº

æœ¬æ–‡æ˜¯ [mpvè¿›é˜¶çš„å°èŠ‚4](https://hooke007.github.io/unofficial/mpv_start.html#id15) & [ã€Šå¿«æ·é”®è‡ªå®šä¹‰ä¸æ§åˆ¶å°ã€‹](https://hooke007.github.io/unofficial/mpv_input.html) çš„æ‹“å±•å†…å®¹ã€‚

å…³è”å®˜æ–¹æ‰‹å†Œéƒ¨åˆ† [Manual_filters](https://mpv.io/manual/master/#video-filters)

æœ¬æ–‡åªä»¥è§†é¢‘æ»¤é•œä¸ºä¾‹è¿›è¡Œè®²è§£ï¼ˆéŸ³é¢‘æ»¤é•œçš„ç”¨æ³•å®Œå…¨ä¸€è‡´ï¼‰  
_æ»¤é•œ ä¹Ÿå¸¸è¢«ç¿»è¯‘ä½œ è¿‡æ»¤å™¨_

é»˜è®¤å¿«æ·é”® (<kbd>Shift</kbd> + ) <kbd>i</kbd> çš„ç¬¬ä¸€é¡µä¸‹æ–¹æ˜¾ç¤ºå·²æŒ‚è½½çš„ç”¨æˆ·æ»¤é•œåˆ—è¡¨ `Filters:` ã€‚æ— æŒ‚è½½åˆ™ä¸æ˜¾ç¤ºè¯¥æ¡ç›®  
ğŸ”º å°½é‡ä½¿ç”¨è½¯è§£æˆ–å¸¦å¤åˆ¶çš„ç¡¬è§£ï¼ˆå³ `--hwdec=no` æˆ– `--hwdec=auto-copy` ï¼‰ï¼Œå¤§å¤šæ•°æ»¤é•œæ— æ³•åœ¨åŸç”Ÿç¡¬è§£ï¼ˆå³ `--hwdec=yes` ï¼‰ä¸‹å·¥ä½œ

æœ¬æ–‡åé‡å†™æ³•è€Œä¸æ˜¯å®é™…ç”¨é€”ï¼Œæ¨èç†Ÿæ‚‰è¯­æ³•åå†æŸ¥çœ‹ [ã€Šå®ç”¨å‘çš„æ»¤é•œã€‹](https://github.com/hooke007/mpv_PlayKit/discussions/120) ä¸­çš„è¯¸å¤šæ¡ˆä¾‹ã€‚

## 1.è¯­æ³•ç®€è¿°

é€šå¸¸å¯ä»¥é€šè¿‡ `--vf` é€‰é¡¹ä½¿ç”¨è§†é¢‘æ»¤é•œ  
æ»¤é•œå­˜åœ¨åˆ—è¡¨ç®¡ç†çš„æ€§è´¨ï¼Œå› æ­¤æœ‰ä¸åŒçš„åç¼€å¯æ­é… â€”â€”

| åç¼€   | å«ä¹‰ |
| :----- | :----- |
| set    | è®¾ç½®æ»¤é•œé“¾ï¼ˆå¤šä¸ªæ»¤é•œä¹‹é—´ä½¿ç”¨åŠè§’é€—å· <kbd>,</kbd> ä½œä¸ºåˆ†éš”ç¬¦ï¼‰ |
| append | è¿½åŠ å•ä¸ªæ»¤é•œï¼ˆåœ¨åæ–¹ï¼‰ |
| add    | è¿½åŠ å•ä¸ªæˆ–å¤šä¸ªæ»¤é•œï¼ˆåœ¨åæ–¹ï¼‰ |
| pre    | è¿½åŠ å•ä¸ªæˆ–å¤šä¸ªæ»¤é•œï¼ˆåœ¨å‰æ–¹ï¼‰ |
| clr    | ç§»é™¤æ‰€æœ‰æ»¤é•œ |
| remove | ç§»é™¤æŒ‡å®šçš„æ»¤é•œ |
| toggle | è¿½åŠ æŒ‡å®šçš„æ»¤é•œï¼ˆåœ¨åæ–¹ï¼‰ï¼Œä½†å¦‚æœå·²ç»å­˜åœ¨åˆ™ç§»é™¤è¯¥æ»¤é•œ |
| help   | ä»…æ”¯æŒåœ¨ç»ˆç«¯ä½¿ç”¨ï¼Œç”¨äºè¾“å‡ºè¯¥æ»¤é•œçš„æ›´å¤šä¿¡æ¯ |

å…ˆä¸è€ƒè™‘åç¼€ï¼Œæ’å…¥æ»¤é•œçš„è¯­æ³•ä¸ºï¼š

- æŒ‚è½½æŸä¸ªæ»¤é•œï¼ˆæœ€ç®€æœ€åŸºç¡€ï¼‰ `vf=æ»¤é•œå`
- æŒ‚è½½æŸä¸ªæ»¤é•œæ—¶å¯¹å…¶ä¸­çš„å­å‚æ•°è¿›è¡ŒæŒ‡å®š `vf=æ»¤é•œå=å­å‚æ•°1:å­å‚æ•°2`
- æŒ‚è½½å¤šä¸ªæ»¤é•œçš„æœ€ç®€æ–¹å¼ `vf=æ»¤é•œ1,æ»¤é•œ2`
- æŒ‚è½½æŸä¸ªæ»¤é•œæ—¶æ‰‹åŠ¨æ‰“ä¸Š **æ ‡ç­¾** `vf=@æ ‡ç­¾å:!æ»¤é•œå`

ğŸ”º æ ‡ç­¾çš„ç”¨é€”ä¹‹ä¸€æ˜¯ä¾¿äºç®¡ç†ï¼Œä¾‹å¦‚æ‰‹åŠ¨æ’å…¥ä¸€ä¸ªå¤æ‚çš„æ»¤é•œæ—¶ `vf=@æ ‡ç­¾1:æ»¤é•œ1=å­å‚æ•°1:å­å‚æ•°2:å­å‚æ•°3` ï¼Œç§»é™¤å®ƒåªéœ€è¦ `vf-del=@æ ‡ç­¾1` å³å¯ã€‚

### 1.1.mpv.conf

åœ¨ä¸»è®¾ç½®æ–‡ä»¶ä¸­ä½¿ç”¨æ—¶é€šå¸¸æ˜¯ä¸ºäº†ä¼´éšmpvå¯åŠ¨æ—¶è‡ªåŠ¨åº”ç”¨æŸäº›æ»¤é•œï¼Œä¾‹å¦‚ï¼š
```ini
vf=vflip,hflip   # å‚ç›´ç¿»è½¬ â†’ æ°´å¹³ç¿»è½¬
```

å¦‚æœä½ çš„æ»¤é•œé“¾æ¯”è¾ƒå¤æ‚ï¼Œæ¨èæ‹†å¼€å†™ï¼ˆå¸¦appendåç¼€çš„é€‰é¡¹ä¸ä¼šç›¸äº’è¦†ç›–ï¼‰ï¼š
```ini
vf=vflip
vf-append=hflip
```

æˆ–è€…ï¼š
```ini
vf-append=vflip
vf-append=hflip
```

å¯èƒ½æœ‰é¢å¯¹ä¸åŒçš„åˆ†è¾¨ç‡è¿›è¡Œè‡ªåŠ¨å¤„ç†çš„éœ€è¦ï¼Œå¯ä»¥åœ¨profileä¸­æ“ä½œï¼Œæ­¤å¤„åªç®€å•ä¸¾ä¾‹ï¼Œå®é™…åº”ç”¨æ—¶è‡ªè¡Œä¸¾ä¸€åä¸‰ï¼š
```ini
[4k_fast]
profile-cond=height>2000 and width>3000
profile-restore=copy
vf-clr
```

### 1.2.input.conf & æ§åˆ¶å°

æ»¤é•œåœ¨å¿«æ·é”®ä¸æ§åˆ¶å°ä¸­æœ‰ç‹¬ç‰¹çš„è¯­æ³•ï¼Œç®€å•è®²å°±æ˜¯å‚è€ƒä¸Šæ–¹çš„è¡¨æ ¼ä¸­çš„åç¼€ï¼Œä½†ç§»é™¤è¿æ¥ç¬¦ `-` ä¸” `vf` æå‰ï¼Œç¤ºä¾‹ï¼š
```ini
a   vf set vflip,hflip
s   vf append vflip
d   vf add vflip,hflip
f   vf pre vflip,hflip
g   vf clr ""
h   vf remove vflip
j   vf toggle vflip
```

ğŸ”º æ ¹æ®inputè¯­æ³•ä¸­çš„â€œæ“ä½œå±æ€§â€çš„ç”¨æ³•ï¼Œ `vf set vflip,hflip` äº¦ç­‰æ•ˆ `set vf vflip,hflip`  
`vf clr ""` çš„ä½œç”¨ä¹Ÿå¯é€šè¿‡ `set vf ""` æ¥è¾¾æˆã€‚

## 2.æ»¤é•œåˆ†ç±»

mpvæ‰€èƒ½ä½¿ç”¨çš„æ»¤é•œå¤§ä½“åˆ†ä¸ºä¸¤ç±» â€”â€”

mpvè‡ªå·±å®ç°çš„æ»¤é•œï¼š  
[format](https://mpv.io/manual/master/#video-filters-format) & [sub](https://mpv.io/manual/master/#video-filters-sub) & [vapoursynth](https://mpv.io/manual/master/#video-filters-vapoursynth) & [vavpp](https://mpv.io/manual/master/#video-filters-vavpp) & [vdpaupp](https://mpv.io/manual/master/#video-filters-vdpaupp) & [d3d11vpp](https://mpv.io/manual/master/#video-filters-d3d11vpp) & [fingerprint](https://mpv.io/manual/master/#video-filters-fingerprint) & [gpu](https://mpv.io/manual/master/#video-filters-gpu)

æ¥è‡ªffmpegçš„æ»¤é•œï¼š  
[lavfi](https://mpv.io/manual/master/#video-filters-lavfi)

æ ¹æ®ç‰ˆæœ¬ã€å¹³å°å’Œç¼–è¯‘é€‰é¡¹çš„ä¸åŒï¼Œä½ æ‰€èƒ½å®é™…ä½¿ç”¨æ»¤é•œç±»å‹å’Œä¸ªæ•°å¹¶ä¸æ’å®šï¼Œå¯é€šè¿‡å¦‚ä¸‹æ–¹å¼æŸ¥çœ‹ï¼š  
å®šä½åˆ° **mpv.com** æ‰€åœ¨ç›®å½•ï¼Œæ‰“å¼€ powershell æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹è§†é¢‘æ»¤é•œçš„ç»¼åˆä¿¡æ¯ â€”â€”
```powershell
./mpv --vf=help
```

```{image} _assets/mpv_filters-terminal_01.jpg
:alt: stats_01
:width: 600 px
:align: center
```

ğŸ”º `Available libavfilter filters:` æ­¤è¡Œå¾€ä¸‹åˆ—å‡ºçš„å³â€œæ¥è‡ªffmpegçš„æ»¤é•œâ€  
ffmpegæ»¤é•œæœ‰è‡ªå·±çš„ [æ–‡æ¡£](https://ffmpeg.org/ffmpeg-filters.html) ï¼Œå®ƒä»¬å¹¶ä¸åœ¨mpvçš„å®˜æ–¹æ‰‹å†Œä¸­è®°å½•

é™¤å¼€æ‰‹å†Œå¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡å¦‚ä¸‹æŒ‡ä»¤æŸ¥çœ‹æ»¤é•œçš„å­å‚æ•°
```powershell
./mpv --vf=æ»¤é•œå=help
```

### 2.1.åŸç”Ÿæ»¤é•œ

å³â€œmpvè‡ªå·±å®ç°çš„æ»¤é•œâ€

ä½¿ç”¨æ—¶æ³¨æ„å®ƒä»¬çš„æ»¤é•œåï¼ˆä¸€èˆ¬æƒ…å†µä¸‹ï¼‰éœ€è¦å†™å®Œæ•´ï¼ˆä¸èƒ½è·³è¿‡ä¸­é—´çš„é¡¹ï¼‰ï¼Œç¤ºä¾‹ï¼š
```ini
vf=format=fmt=brga   # è½¬æ¢ä¸ºbrgaæ ¼å¼è¾“å‡º
```

å…¶ä¸­ `format=fmt` ä¸ºå®Œæ•´æ»¤é•œåï¼ˆ `fmt` ä¸å¯çœç•¥ï¼‰ï¼Œè€Œ `brga` ä¸ºå‚æ•°å€¼ã€‚

### 2.2.éåŸç”Ÿæ»¤é•œ

å³â€œæ¥è‡ªffmpegçš„æ»¤é•œâ€

ä½¿ç”¨æ—¶å¯æ¥å—å¤šç§è¯­æ³•ï¼Œå› ä¸ºåŸå§‹è¯­æ³•è¾ƒä¸ºå¤æ‚æ˜“äºå‡ºé”™ï¼Œå‚è€ƒå¦‚ä¸‹ç¤ºä¾‹ï¼ˆä»¥ä¸‹å†™æ³•çš†æ­£ç¡®ï¼‰ï¼š
```ini
vf=lavfi=[fps=60]
vf=lavfi="fps=60"
vf=lavfi=graph="fps=60"
vf=fps=60
```

å‡ºäºç®€åŒ–åŸå› ï¼Œå› æ­¤é€šå¸¸ä½¿ç”¨ç®€åŒ–è¯­æ³• `vf=fps=60` ï¼›  
é€šè¿‡æŸ¥é˜… [æ–‡æ¡£](https://ffmpeg.org/ffmpeg-filters.html#fps-1) å¯çŸ¥è¯¥æ»¤é•œæœ‰å¦‚ä¸‹å­å‚æ•° `fps` `start_time` `round` `eof_action`  
ç”±æ­¤ä½“ç°äº†éåŸç”Ÿæ»¤é•œçš„å¦å¤–çš„è¯­æ³•ç‰¹æ€§æ˜¯å¯ä»¥è¿›ä¸€æ­¥ç²¾ç®€ï¼Œå³ `vf=fps=60` ç­‰æ•ˆ `vf=fps=fps=60`

_æˆ‘æ¨èå°½å¯èƒ½æŠŠå­å‚æ•°åå†™ä¸Šï¼Œå¦‚æœä¸å†™å­å‚æ•°åï¼Œmpvä¼šå°è¯•è‡ªåŠ¨æ‰“ä¸Šæ ‡ç­¾ã€‚_

ğŸ”º åŸç”Ÿä¸éåŸç”Ÿæ»¤é•œä¸­å¯èƒ½å­˜åœ¨é‡åçš„æ¡ç›®ï¼Œä¾‹å¦‚é€šå¸¸å½“ä½¿ç”¨ `vf=format=...` æ—¶é¦–é€‰mpvæ»¤é•œï¼Œæœ€ç®€çš„è§£å†³æ–¹æ¡ˆæ˜¯æ˜¾å¼æŒ‡å®šä¸ºffmpegæ»¤é•œï¼Œå³ `--vf=lavfi-format=...`

ğŸ”º æ€§èƒ½æé€Ÿå°æŠ€å·§ï¼š  
å½“åªä½¿ç”¨å¤šä¸ªéåŸç”Ÿæ»¤é•œæ—¶ï¼Œå»ºè®®åˆå¹¶è¿›ä¸€ä¸ªfiltergraphå¤„ç†ï¼Œç¤ºä¾‹ ä¼˜å…ˆç”¨ `vf="lavfi=[vflip,hflip]"` è€Œä¸æ˜¯ `vf=vflip,hflip`

#### 2.2.1.å­—ç¬¦ä¸²å¤„ç†

éåŸç”Ÿæ»¤é•œä¸­çš„å¾ˆå¤šæ»¤é•œæ”¯æŒå¼•å…¥å¤–éƒ¨æ–‡ä»¶å‚ä¸å¤„ç†ï¼Œä¾‹å¦‚ `lut3d` [æ–‡æ¡£](https://ffmpeg.org/ffmpeg-filters.html#lut3d-1)

å‡è®¾å·²ä¸‹è½½ `xxx.cube` æ–‡ä»¶åˆ°è·¯å¾„ `D:/luts test/`  
ğŸ”º éåŸç”Ÿæ»¤é•œä¸æ”¯æŒè¯¸å¦‚ `~~/` ä¹‹ç±»çš„ç›¸å¯¹è·¯å¾„

å¦‚æœåªåœ¨ mpv.conf ä¸­ä½¿ç”¨ï¼Œååˆ†ç®€å•
```ini
vf=lut3d=file="D:/luts test/pinkgirl.cube":interp=trilinear
```

ä½†æ˜¯è‹¥ç”¨åœ¨ input.conf ä¸­ï¼Œå­˜åœ¨è¯­æ³•ä¸Šçš„æš—ç—…ï¼Œéœ€è¦å¤„ç†å…¶ä¸­çš„ç‰¹æ®Šå­—ç¬¦
```ini
Ctrl+l   vf toggle "lut3d=file=\"D:/luts test/pinkgirl.cube\":interp=trilinear"
```

æˆ–è€…ç®€å•ç²—æš´çš„ä½¿ç”¨ [è‡ªå®šä¹‰å¼•ç”¨](https://mpv.io/manual/master/#flat-command-syntax)
```ini
Ctrl+l vf toggle ``lut3d=file="D:/luts test/pinkgirl.cube":interp=trilinear``
```
